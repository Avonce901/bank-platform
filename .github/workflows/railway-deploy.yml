name: ğŸš€ Auto-Deploy to Railway

on:
  push:
    branches:
      - copilot/devfixdeploy
    paths:
      - 'django-banking-app/**'
      - 'railway.json'
      - '.env.example'
      - '.github/workflows/railway-deploy.yml'

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ğŸ” Authenticate with Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          if [ -z "$RAILWAY_TOKEN" ]; then
            echo "âš ï¸  RAILWAY_TOKEN not configured"
            echo "To enable auto-deploy, add RAILWAY_TOKEN to GitHub Secrets:"
            echo "1. Go to Settings â†’ Secrets and variables â†’ Actions"
            echo "2. Click 'New repository secret'"
            echo "3. Name: RAILWAY_TOKEN"
            echo "4. Value: <your-railway-api-token>"
            exit 0
          fi
          echo "âœ… Railway token configured"
      
      - name: ğŸš€ Trigger Railway Deployment
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          if [ -n "$RAILWAY_TOKEN" ]; then
            echo "Deploying to Railway..."
            # Railway will auto-deploy when GitHub is linked
            # This is just a notification that new code is available
            curl -X POST "https://api.railway.app/graphql" \
              -H "Authorization: Bearer $RAILWAY_TOKEN" \
              -H "Content-Type: application/json" \
              -d '{"query":"query { me { id } }"}' || true
          fi
      
      - name: âœ… Deployment Status
        run: |
          echo "âœ… Code pushed to copilot/devfixdeploy"
          echo "ğŸ“‹ Railway will auto-deploy if linked to GitHub"
          echo "ğŸ”— View deployment: https://railway.app/dashboard"
